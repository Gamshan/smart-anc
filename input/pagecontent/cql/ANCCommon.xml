<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableDateRangeOptimization,EnableAnnotations,EnableLocators,EnableResultTypes,DisableListDemotion,DisableListPromotion,DisableMethodInvocation" xsi:type="a:CqlToElmInfo"/>
   <identifier id="ANCCommon" version="0.1.0"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="3:1-3:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.0"/>
   </usings>
   <includes>
      <def localId="2" locator="5:1-5:35" localIdentifier="FHIRHelpers" path="FHIRHelpers" version="4.0.0"/>
      <def localId="3" locator="6:1-6:44" localIdentifier="FC" path="FHIRCommon" version="0.1.0"/>
   </includes>
   <parameters>
      <def localId="36" locator="32:1-32:39" resultTypeName="fhir:Encounter" name="EncounterInProgress" accessLevel="Public">
         <parameterTypeSpecifier localId="35" locator="32:31-32:39" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
      </def>
   </parameters>
   <codeSystems>
      <def localId="4" locator="8:1-8:78" name="ANCCodes" id="http://fhir.org/guides/who/anc-cds/CodeSystem/anc-codes" accessLevel="Public">
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
      </def>
      <def localId="5" locator="9:1-9:55" name="OpenMRSEntity" id="http://openmrs.org/concepts" accessLevel="Public">
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
      </def>
   </codeSystems>
   <valueSets>
      <def localId="6" locator="11:1-11:35" name="Haemoglobin Tests" id="TBD" accessLevel="Public">
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
      </def>
   </valueSets>
   <codes>
      <def localId="8" locator="13:1-13:59" resultTypeName="t:Code" name="ANC Pregnancy Case" id="hacc" accessLevel="Public">
         <codeSystem localId="7" locator="13:40-13:59" name="EpisodeOfCareType" libraryName="FC">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="10" locator="16:1-16:153" resultTypeName="t:Code" name="Hb Complete Blood Count" id="1019AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Complete blood count test result (g/dl) (recommended)" accessLevel="Public">
         <codeSystem localId="9" locator="16:77-16:89" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="12" locator="18:1-18:147" resultTypeName="t:Code" name="Hb Haemoglobinometer" id="165395AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Haemoglobin measured from haemoglobinometer (g/dl)" accessLevel="Public">
         <codeSystem localId="11" locator="18:74-18:86" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="14" locator="19:1-19:135" resultTypeName="t:Code" name="Hb Color Scale" id="165396AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Haemoglobin measured from color scale (g/dl)" accessLevel="Public">
         <codeSystem localId="13" locator="19:68-19:80" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="16" locator="20:1-20:107" resultTypeName="t:Code" name="LMP" id="1427AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Date of last menstrual period" accessLevel="Public">
         <codeSystem localId="15" locator="20:55-20:67" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="18" locator="21:1-21:127" resultTypeName="t:Code" name="UltrasoundGA" id="165220AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Gestational age in weeks from ultrasound" accessLevel="Public">
         <codeSystem localId="17" locator="21:64-21:76" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="20" locator="22:1-22:100" resultTypeName="t:Code" name="FundalHeight" id="1439AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="FUNDAL HEIGHT" accessLevel="Public">
         <codeSystem localId="19" locator="22:64-22:76" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="22" locator="23:1-23:125" resultTypeName="t:Code" name="Weeks of gestational age" id="1438AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" display="Weeks of gestational age" accessLevel="Public">
         <codeSystem localId="21" locator="23:78-23:90" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="24" locator="24:1-24:50" resultTypeName="t:Code" name="Pregnancy (finding)" id="TBD" accessLevel="Public">
         <codeSystem localId="23" locator="24:40-24:50" name="SNOMEDCT" libraryName="FC">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="26" locator="25:1-25:53" resultTypeName="t:Code" name="Ultrasound (procedure)" id="TBD" accessLevel="Public">
         <codeSystem localId="25" locator="25:43-25:53" name="SNOMEDCT" libraryName="FC">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="28" locator="27:1-27:74" resultTypeName="t:Code" name="Selected Gestational Age Method" id="GestAgeMethod" accessLevel="Public">
         <codeSystem localId="27" locator="27:62-27:74" name="OpenMRSEntity">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="30" locator="28:1-28:37" resultTypeName="t:Code" name="UseLMP" id="UseLMP" accessLevel="Public">
         <codeSystem localId="29" locator="28:30-28:37" name="ANCCodes">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="32" locator="29:1-29:51" resultTypeName="t:Code" name="UseUltrasound" id="UseUltrasound" accessLevel="Public">
         <codeSystem localId="31" locator="29:44-29:51" name="ANCCodes">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
      <def localId="34" locator="30:1-30:37" resultTypeName="t:Code" name="UseSFH" id="UseSFH" accessLevel="Public">
         <codeSystem localId="33" locator="30:30-30:37" name="ANCCodes">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="t:Code" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
         </codeSystem>
      </def>
   </codes>
   <statements>
      <def locator="34:1-34:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="34:1-34:15" dataType="fhir:Patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="52" locator="43:1-49:2" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="52">
               <a:s>define pregnancy:&#xd;
  </a:s>
               <a:s r="51">
                  <a:s>First(&#xd;
		//[&quot;EpisodeOfCare&quot;: type in &quot;ANC Pregnancy Case&quot;] E&#xd;
    </a:s>
                  <a:s r="50">
                     <a:s>
                        <a:s r="38">
                           <a:s r="37">
                              <a:s r="37">
                                 <a:s>[&quot;EpisodeOfCare&quot;]</a:s>
                              </a:s>
                           </a:s>
                           <a:s> E</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
      </a:s>
                     <a:s r="45">
                        <a:s>where </a:s>
                        <a:s r="45">
                           <a:s>exists </a:s>
                           <a:s r="44">
                              <a:s>(</a:s>
                              <a:s r="44">
                                 <a:s>
                                    <a:s r="40">
                                       <a:s r="39">
                                          <a:s>
                                             <a:s>E.type</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> C</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="43">
                                    <a:s>where </a:s>
                                    <a:s r="43">
                                       <a:s r="41">
                                          <a:s>C</a:s>
                                       </a:s>
                                       <a:s> ~ </a:s>
                                       <a:s r="42">
                                          <a:s>&quot;ANC Pregnancy Case&quot;</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
		  </a:s>
                     <a:s r="49">
                        <a:s>sort by </a:s>
                        <a:s r="48">
                           <a:s r="47">
                              <a:s>start of </a:s>
                              <a:s r="46">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s> descending</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
	)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="51" locator="44:3-49:2" resultTypeName="fhir:EpisodeOfCare" xsi:type="First">
            <source localId="50" locator="46:5-48:38" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:EpisodeOfCare" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="38" locator="46:5-46:23" alias="E">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:EpisodeOfCare" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="37" locator="46:5-46:21" dataType="fhir:EpisodeOfCare" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:EpisodeOfCare" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="45" locator="47:7-47:60" resultTypeName="t:Boolean" xsi:type="Exists">
                  <operand localId="44" locator="47:20-47:60" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="40" locator="47:21-47:28" alias="C">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="39" locator="47:21-47:26" path="type" scope="E" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="43" locator="47:30-47:59" resultTypeName="t:Boolean" xsi:type="Equivalent">
                        <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="41" locator="47:36" resultTypeName="fhir:CodeableConcept" name="C" xsi:type="AliasRef"/>
                        </operand>
                        <operand xsi:type="ToConcept">
                           <operand localId="42" locator="47:40-47:59" resultTypeName="t:Code" name="ANC Pregnancy Case" xsi:type="CodeRef"/>
                        </operand>
                     </where>
                  </operand>
               </where>
               <sort localId="49" locator="48:5-48:38">
                  <by localId="48" locator="48:13-48:38" resultTypeName="t:DateTime" direction="descending" xsi:type="ByExpression">
                     <expression localId="47" locator="48:13-48:27" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="46" locator="48:22-48:27" resultTypeName="fhir:Period" name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
      </def>
      <def localId="55" locator="40:1-41:23" resultTypeName="t:Boolean" name="pregnant" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="55">
               <a:s>define pregnant:&#xd;
  </a:s>
               <a:s r="54">
                  <a:s r="53">
                     <a:s>pregnancy</a:s>
                  </a:s>
                  <a:s> is not null</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="54" locator="41:3-41:23" resultTypeName="t:Boolean" xsi:type="Not">
            <operand locator="41:3-41:23" resultTypeName="t:Boolean" xsi:type="IsNull">
               <operand localId="53" locator="41:3-41:11" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
      <def localId="85" locator="51:1-55:70" name="pregnancyCondition" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="85">
               <a:s>define pregnancyCondition:&#xd;
  </a:s>
               <a:s r="84">
                  <a:s>
                     <a:s r="57">
                        <a:s r="56">
                           <a:s r="56">
                              <a:s>[&quot;Condition&quot;: </a:s>
                              <a:s>
                                 <a:s>code</a:s>
                              </a:s>
                              <a:s> in </a:s>
                              <a:s>
                                 <a:s>&quot;Pregnancy (finding)&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> C</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
	  </a:s>
                  <a:s r="83">
                     <a:s>where </a:s>
                     <a:s r="83">
                        <a:s r="75">
                           <a:s r="67">
                              <a:s r="59">
                                 <a:s r="58">
                                    <a:s>C</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="59">
                                    <a:s>id</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="66">
                                 <a:s r="60">
                                    <a:s>FC</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="66">
                                    <a:s>GetId(</a:s>
                                    <a:s r="65">
                                       <a:s r="64">
                                          <a:s r="63">
                                             <a:s>First(</a:s>
                                             <a:s r="62">
                                                <a:s r="61">
                                                   <a:s>pregnancy</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="62">
                                                   <a:s>diagnosis</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>)</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="64">
                                             <a:s>condition</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="65">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
      and </a:s>
                           <a:s r="74">
                              <a:s r="71">
                                 <a:s r="68">
                                    <a:s>FHIRHelpers</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="71">
                                    <a:s>ToConcept(</a:s>
                                    <a:s r="70">
                                       <a:s r="69">
                                          <a:s>C</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="70">
                                          <a:s>clinicalStatus</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> ~ </a:s>
                              <a:s r="73">
                                 <a:s r="72">
                                    <a:s>FC</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="73">
                                    <a:s>&quot;active&quot;</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
      and </a:s>
                        <a:s r="82">
                           <a:s r="79">
                              <a:s r="76">
                                 <a:s>FHIRHelpers</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="79">
                                 <a:s>ToConcept(</a:s>
                                 <a:s r="78">
                                    <a:s r="77">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="78">
                                       <a:s>verificationStatus</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s> ~ </a:s>
                           <a:s r="81">
                              <a:s r="80">
                                 <a:s>FC</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="81">
                                 <a:s>&quot;confirmed&quot;</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="84" locator="52:3-55:70" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="57" locator="52:3-52:48" alias="C">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="56" locator="52:3-52:46" dataType="fhir:Condition" codeProperty="code" xsi:type="Retrieve">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <codes xsi:type="ToList">
                     <operand locator="52:25-52:45" resultTypeName="t:Code" name="Pregnancy (finding)" xsi:type="CodeRef"/>
                  </codes>
               </expression>
            </source>
            <where localId="83" locator="53:4-55:70" resultTypeName="t:Boolean" xsi:type="And">
               <operand localId="75" locator="53:10-54:63" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="67" locator="53:10-53:72" resultTypeName="t:Boolean" xsi:type="Equal">
                     <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="59" locator="53:10-53:13" resultTypeName="fhir:id" path="id" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand localId="66" locator="53:17-53:72" resultTypeName="t:String" name="GetId" libraryName="FC" xsi:type="FunctionRef">
                        <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="65" locator="53:26-53:71" resultTypeName="fhir:string" path="reference" xsi:type="Property">
                              <source localId="64" locator="53:26-53:61" resultTypeName="fhir:Reference" path="condition" xsi:type="Property">
                                 <source localId="63" locator="53:26-53:51" resultTypeName="fhir:EpisodeOfCare.Diagnosis" xsi:type="First">
                                    <source localId="62" locator="53:32-53:50" path="diagnosis" xsi:type="Property">
                                       <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                          <elementType name="fhir:EpisodeOfCare.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <source localId="61" locator="53:32-53:40" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" xsi:type="ExpressionRef"/>
                                    </source>
                                 </source>
                              </source>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="74" locator="54:11-54:63" resultTypeName="t:Boolean" xsi:type="Equivalent">
                     <operand localId="71" locator="54:11-54:49" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="70" locator="54:33-54:48" resultTypeName="fhir:CodeableConcept" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand localId="73" locator="54:53-54:63" resultTypeName="t:Code" name="active" libraryName="FC" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
               </operand>
               <operand localId="82" locator="55:11-55:70" resultTypeName="t:Boolean" xsi:type="Equivalent">
                  <operand localId="79" locator="55:11-55:53" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="78" locator="55:33-55:52" resultTypeName="fhir:CodeableConcept" path="verificationStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand localId="81" locator="55:57-55:70" resultTypeName="t:Code" name="confirmed" libraryName="FC" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="107" locator="57:1-64:2" resultTypeName="t:DateTime" name="lmp" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="107">
               <a:s>define lmp:&#xd;
  </a:s>
               <a:s r="106">
                  <a:s>First(&#xd;
	  </a:s>
                  <a:s r="105">
                     <a:s>
                        <a:s r="87">
                           <a:s r="86">
                              <a:s r="86">
                                 <a:s>[&quot;Observation&quot;: </a:s>
                                 <a:s>
                                    <a:s>code</a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s>
                                    <a:s>&quot;LMP&quot;</a:s>
                                 </a:s>
                                 <a:s>]</a:s>
                              </a:s>
                           </a:s>
                           <a:s> O</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
			</a:s>
                     <a:s r="98">
                        <a:s>where </a:s>
                        <a:s r="98">
                           <a:s r="91">
                              <a:s r="89">
                                 <a:s r="88">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="89">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="90">
                                 <a:s>'final'</a:s>
                              </a:s>
                           </a:s>
                           <a:s> // TODO: Verify status here&#xd;
			  and </a:s>
                           <a:s r="97">
                              <a:s r="93">
                                 <a:s r="92">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="93">
                                    <a:s>issued</a:s>
                                 </a:s>
                              </a:s>
                              <a:s r="97"> on or after </a:s>
                              <a:s r="96">
                                 <a:s>start of </a:s>
                                 <a:s r="95">
                                    <a:s r="94">
                                       <a:s>pregnancy</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="95">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
			</a:s>
                     <a:s r="103">
                        <a:s>return </a:s>
                        <a:s r="102">
                           <a:s r="99">
                              <a:s>FHIRHelpers</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="102">
                              <a:s>ToDateTime(</a:s>
                              <a:s r="101">
                                 <a:s r="100">
                                    <a:s>O</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="101">
                                    <a:s>value</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s r="104">&#xd;
			sort desc</a:s>
                  </a:s>
                  <a:s>&#xd;
	)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="106" locator="58:3-64:2" resultTypeName="t:DateTime" xsi:type="First">
            <source localId="105" locator="59:4-63:12" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="87" locator="59:4-59:35" alias="O">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="86" locator="59:4-59:33" dataType="fhir:Observation" codeProperty="code" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <codes xsi:type="ToList">
                        <operand locator="59:28-59:32" resultTypeName="t:Code" name="LMP" xsi:type="CodeRef"/>
                     </codes>
                  </expression>
               </source>
               <where localId="98" locator="60:4-61:55" resultTypeName="t:Boolean" xsi:type="And">
                  <operand localId="91" locator="60:10-60:27" resultTypeName="t:Boolean" xsi:type="Equal">
                     <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="89" locator="60:10-60:17" resultTypeName="fhir:ObservationStatus" path="status" scope="O" xsi:type="Property"/>
                     </operand>
                     <operand localId="90" locator="60:21-60:27" resultTypeName="t:String" valueType="t:String" value="final" xsi:type="Literal"/>
                  </operand>
                  <operand localId="97" locator="61:10-61:55" resultTypeName="t:Boolean" xsi:type="SameOrAfter">
                     <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand localId="93" locator="61:10-61:17" resultTypeName="fhir:instant" path="issued" scope="O" xsi:type="Property"/>
                     </operand>
                     <operand localId="96" locator="61:31-61:55" resultTypeName="t:DateTime" xsi:type="Start">
                        <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <operand localId="95" locator="61:40-61:55" resultTypeName="fhir:Period" path="period" xsi:type="Property">
                              <source localId="94" locator="61:40-61:48" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" xsi:type="ExpressionRef"/>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <return localId="103" locator="62:4-62:41">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="102" locator="62:11-62:41" resultTypeName="t:DateTime" name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand asType="fhir:dateTime" xsi:type="As">
                        <operand localId="101" locator="62:34-62:40" path="value" scope="O" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                              <choice name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:boolean" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:integer" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Ratio" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:SampledData" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                              <choice name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </operand>
                     </operand>
                  </expression>
               </return>
               <sort localId="104" locator="63:4-63:12">
                  <by direction="desc" xsi:type="ByDirection"/>
               </sort>
            </source>
         </expression>
      </def>
      <def localId="111" locator="66:1-66:34" resultTypeName="t:Boolean" name="lmp_known" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="111">
               <a:s>define lmp_known: </a:s>
               <a:s r="110">
                  <a:s>not</a:s>
                  <a:s r="109">
                     <a:s>(</a:s>
                     <a:s r="109">
                        <a:s r="108">
                           <a:s>lmp</a:s>
                        </a:s>
                        <a:s> is null</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="110" locator="66:19-66:34" resultTypeName="t:Boolean" xsi:type="Not">
            <operand localId="109" locator="66:22-66:34" resultTypeName="t:Boolean" xsi:type="IsNull">
               <operand localId="108" locator="66:23-66:25" resultTypeName="t:DateTime" name="lmp" xsi:type="ExpressionRef"/>
            </operand>
         </expression>
      </def>
      <def localId="117" locator="68:1-68:39" resultTypeName="t:DateTime" name="lmp_edd" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="117">
               <a:s>define lmp_edd: </a:s>
               <a:s r="116">
                  <a:s r="114">
                     <a:s r="112">
                        <a:s>lmp</a:s>
                     </a:s>
                     <a:s> + </a:s>
                     <a:s r="113">
                        <a:s>7 days</a:s>
                     </a:s>
                  </a:s>
                  <a:s> + </a:s>
                  <a:s r="115">
                     <a:s>9 months</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="116" locator="68:17-68:39" resultTypeName="t:DateTime" xsi:type="Add">
            <operand localId="114" locator="68:17-68:28" resultTypeName="t:DateTime" xsi:type="Add">
               <operand localId="112" locator="68:17-68:19" resultTypeName="t:DateTime" name="lmp" xsi:type="ExpressionRef"/>
               <operand localId="113" locator="68:23-68:28" resultTypeName="t:Quantity" value="7" unit="days" xsi:type="Quantity"/>
            </operand>
            <operand localId="115" locator="68:32-68:39" resultTypeName="t:Quantity" value="9" unit="months" xsi:type="Quantity"/>
         </expression>
      </def>
      <def localId="123" locator="71:1-71:63" resultTypeName="t:Integer" name="lmp_gest_age_weeks" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="123">
               <a:s>define lmp_gest_age_weeks: </a:s>
               <a:s r="122">
                  <a:s r="120">
                     <a:s>(</a:s>
                     <a:s r="120">
                        <a:s>days between </a:s>
                        <a:s r="118">
                           <a:s>lmp</a:s>
                        </a:s>
                        <a:s> and </a:s>
                        <a:s r="119">
                           <a:s>Today()</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
                  <a:s r="121"> div 7</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="122" locator="71:28-71:63" resultTypeName="t:Integer" xsi:type="TruncatedDivide">
            <operand localId="120" locator="71:28-71:57" resultTypeName="t:Integer" precision="Day" xsi:type="DurationBetween">
               <operand localId="118" locator="71:42-71:44" resultTypeName="t:DateTime" name="lmp" xsi:type="ExpressionRef"/>
               <operand xsi:type="ToDateTime">
                  <operand localId="119" locator="71:50-71:56" resultTypeName="t:Date" xsi:type="Today"/>
               </operand>
            </operand>
            <operand localId="121" locator="71:63" resultTypeName="t:Integer" valueType="t:Integer" value="7" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="129" locator="72:1-72:67" resultTypeName="t:Integer" name="lmp_gest_age_remainder" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="129">
               <a:s>define lmp_gest_age_remainder: </a:s>
               <a:s r="128">
                  <a:s r="126">
                     <a:s>(</a:s>
                     <a:s r="126">
                        <a:s>days between </a:s>
                        <a:s r="124">
                           <a:s>lmp</a:s>
                        </a:s>
                        <a:s> and </a:s>
                        <a:s r="125">
                           <a:s>Today()</a:s>
                        </a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
                  <a:s r="127"> mod 7</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="128" locator="72:32-72:67" resultTypeName="t:Integer" xsi:type="Modulo">
            <operand localId="126" locator="72:32-72:61" resultTypeName="t:Integer" precision="Day" xsi:type="DurationBetween">
               <operand localId="124" locator="72:46-72:48" resultTypeName="t:DateTime" name="lmp" xsi:type="ExpressionRef"/>
               <operand xsi:type="ToDateTime">
                  <operand localId="125" locator="72:54-72:60" resultTypeName="t:Date" xsi:type="Today"/>
               </operand>
            </operand>
            <operand localId="127" locator="72:67" resultTypeName="t:Integer" valueType="t:Integer" value="7" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="143" locator="74:1-77:43" name="ultrasoundProcedures" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="143">
               <a:s>define ultrasoundProcedures:&#xd;
  </a:s>
               <a:s r="142">
                  <a:s>
                     <a:s r="131">
                        <a:s r="130">
                           <a:s r="130">
                              <a:s>[&quot;Procedure&quot;: </a:s>
                              <a:s>
                                 <a:s>code</a:s>
                              </a:s>
                              <a:s> in </a:s>
                              <a:s>
                                 <a:s>&quot;Ultrasound (procedure)&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> P</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
	  </a:s>
                  <a:s r="141">
                     <a:s>where </a:s>
                     <a:s r="141">
                        <a:s r="135">
                           <a:s r="133">
                              <a:s r="132">
                                 <a:s>P</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="133">
                                 <a:s>status</a:s>
                              </a:s>
                           </a:s>
                           <a:s> = </a:s>
                           <a:s r="134">
                              <a:s>'completed'</a:s>
                           </a:s>
                        </a:s>
                        <a:s>&#xd;
		  and </a:s>
                        <a:s r="140">
                           <a:s r="137">
                              <a:s r="136">
                                 <a:s>P</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="137">
                                 <a:s>performed</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="140"> during </a:s>
                           <a:s r="139">
                              <a:s r="138">
                                 <a:s>pregnancy</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="139">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="142" locator="75:3-77:43" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="131" locator="75:3-75:51" alias="P">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="130" locator="75:3-75:49" dataType="fhir:Procedure" codeProperty="code" dateProperty="performed" xsi:type="Retrieve">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <codes xsi:type="ToList">
                     <operand locator="75:25-75:48" resultTypeName="t:Code" name="Ultrasound (procedure)" xsi:type="CodeRef"/>
                  </codes>
                  <dateRange name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand localId="139" locator="77:28-77:43" resultTypeName="fhir:Period" path="period" xsi:type="Property">
                        <source localId="138" locator="77:28-77:36" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" xsi:type="ExpressionRef"/>
                     </operand>
                  </dateRange>
               </expression>
            </source>
            <where localId="135" locator="76:10-76:31" resultTypeName="t:Boolean" xsi:type="Equal">
               <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand localId="133" locator="76:10-76:17" resultTypeName="fhir:EventStatus" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand localId="134" locator="76:21-76:31" resultTypeName="t:String" valueType="t:String" value="completed" xsi:type="Literal"/>
            </where>
         </expression>
      </def>
      <def localId="165" locator="79:1-87:3" resultTypeName="t:Concept" name="select_gest_age_edd" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="165">
               <a:s>define select_gest_age_edd:&#xd;
  </a:s>
               <a:s r="164">
                  <a:s r="144">
                     <a:s>FHIRHelpers</a:s>
                  </a:s>
                  <a:s>.</a:s>
                  <a:s r="164">
                     <a:s>ToConcept(&#xd;
    </a:s>
                     <a:s r="163">
                        <a:s r="162">
                           <a:s>First(&#xd;
  		</a:s>
                           <a:s r="161">
                              <a:s>
                                 <a:s r="146">
                                    <a:s r="145">
                                       <a:s r="145">
                                          <a:s>[&quot;Observation&quot;: </a:s>
                                          <a:s>
                                             <a:s>code</a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s>
                                             <a:s>&quot;Selected Gestational Age Method&quot;</a:s>
                                          </a:s>
                                          <a:s>]</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> O</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
  		  </a:s>
                              <a:s r="157">
                                 <a:s>where </a:s>
                                 <a:s r="157">
                                    <a:s r="150">
                                       <a:s r="148">
                                          <a:s r="147">
                                             <a:s>O</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="148">
                                             <a:s>status</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="149">
                                          <a:s>'final'</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>&#xd;
  			  and </a:s>
                                    <a:s r="156">
                                       <a:s r="152">
                                          <a:s r="151">
                                             <a:s>O</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="152">
                                             <a:s>issued</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s r="156"> on or after </a:s>
                                       <a:s r="155">
                                          <a:s>start of </a:s>
                                          <a:s r="154">
                                             <a:s r="153">
                                                <a:s>pregnancy</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="154">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>&#xd;
  			</a:s>
                              <a:s r="160">
                                 <a:s>sort by </a:s>
                                 <a:s r="159">
                                    <a:s r="158">
                                       <a:s>issued</a:s>
                                    </a:s>
                                    <a:s> desc</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>&#xd;
  	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="163">
                           <a:s>value</a:s>
                        </a:s>
                     </a:s>
                     <a:s>&#xd;
  )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="164" locator="80:3-87:3" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand asType="fhir:CodeableConcept" xsi:type="As">
               <operand localId="163" locator="81:5-86:10" path="value" xsi:type="Property">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:string" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:boolean" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:integer" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Ratio" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:SampledData" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:time" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <source localId="162" locator="81:5-86:4" resultTypeName="fhir:Observation" xsi:type="First">
                     <source localId="161" locator="82:5-85:24" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="146" locator="82:5-82:64" alias="O">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="145" locator="82:5-82:62" dataType="fhir:Observation" codeProperty="code" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <codes xsi:type="ToList">
                                 <operand locator="82:29-82:61" resultTypeName="t:Code" name="Selected Gestational Age Method" xsi:type="CodeRef"/>
                              </codes>
                           </expression>
                        </source>
                        <where localId="157" locator="83:7-84:57" resultTypeName="t:Boolean" xsi:type="And">
                           <operand localId="150" locator="83:13-83:30" resultTypeName="t:Boolean" xsi:type="Equal">
                              <operand name="ToString" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand localId="148" locator="83:13-83:20" resultTypeName="fhir:ObservationStatus" path="status" scope="O" xsi:type="Property"/>
                              </operand>
                              <operand localId="149" locator="83:24-83:30" resultTypeName="t:String" valueType="t:String" value="final" xsi:type="Literal"/>
                           </operand>
                           <operand localId="156" locator="84:12-84:57" resultTypeName="t:Boolean" xsi:type="SameOrAfter">
                              <operand name="ToDateTime" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <operand localId="152" locator="84:12-84:19" resultTypeName="fhir:instant" path="issued" scope="O" xsi:type="Property"/>
                              </operand>
                              <operand localId="155" locator="84:33-84:57" resultTypeName="t:DateTime" xsi:type="Start">
                                 <operand name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand localId="154" locator="84:42-84:57" resultTypeName="fhir:Period" path="period" xsi:type="Property">
                                       <source localId="153" locator="84:42-84:50" resultTypeName="fhir:EpisodeOfCare" name="pregnancy" xsi:type="ExpressionRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </where>
                        <sort localId="160" locator="85:6-85:24">
                           <by localId="159" locator="85:14-85:24" resultTypeName="fhir:instant" direction="desc" path="issued" xsi:type="ByColumn"/>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
      </def>
      <def localId="169" locator="96:1-96:49" resultTypeName="t:Integer" name="ultrasound_gest_age_weeks" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="169">
               <a:s>define ultrasound_gest_age_weeks: </a:s>
               <a:s r="168">
                  <a:s r="166">null as </a:s>
                  <a:s r="167">
                     <a:s>Integer</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="168" locator="96:35-96:49" resultTypeName="t:Integer" strict="false" xsi:type="As">
            <operand localId="166" locator="96:35-96:38" resultTypeName="t:Any" xsi:type="Null"/>
            <asTypeSpecifier localId="167" locator="96:43-96:49" resultTypeName="t:Integer" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </expression>
      </def>
      <def localId="173" locator="99:1-99:39" resultTypeName="t:DateTime" name="ultrasound_edd" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="173">
               <a:s>define ultrasound_edd: </a:s>
               <a:s r="172">
                  <a:s r="170">null as </a:s>
                  <a:s r="171">
                     <a:s>DateTime</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="172" locator="99:24-99:39" resultTypeName="t:DateTime" strict="false" xsi:type="As">
            <operand localId="170" locator="99:24-99:27" resultTypeName="t:Any" xsi:type="Null"/>
            <asTypeSpecifier localId="171" locator="99:32-99:39" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </expression>
      </def>
      <def localId="177" locator="102:1-102:42" resultTypeName="t:Integer" name="sfh_gest_age_weeks" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="177">
               <a:s>define sfh_gest_age_weeks: </a:s>
               <a:s r="176">
                  <a:s r="174">null as </a:s>
                  <a:s r="175">
                     <a:s>Integer</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="176" locator="102:28-102:42" resultTypeName="t:Integer" strict="false" xsi:type="As">
            <operand localId="174" locator="102:28-102:31" resultTypeName="t:Any" xsi:type="Null"/>
            <asTypeSpecifier localId="175" locator="102:36-102:42" resultTypeName="t:Integer" name="t:Integer" xsi:type="NamedTypeSpecifier"/>
         </expression>
      </def>
      <def localId="181" locator="105:1-105:32" resultTypeName="t:DateTime" name="sfh_edd" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="181">
               <a:s>define sfh_edd: </a:s>
               <a:s r="180">
                  <a:s r="178">null as </a:s>
                  <a:s r="179">
                     <a:s>DateTime</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="180" locator="105:17-105:32" resultTypeName="t:DateTime" strict="false" xsi:type="As">
            <operand localId="178" locator="105:17-105:20" resultTypeName="t:Any" xsi:type="Null"/>
            <asTypeSpecifier localId="179" locator="105:25-105:32" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </expression>
      </def>
      <def localId="194" locator="107:1-113:5" resultTypeName="t:Integer" name="gest_age" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="194">
               <a:s>define gest_age:&#xd;
  </a:s>
               <a:s r="193">
                  <a:s>case </a:s>
                  <a:s r="182">
                     <a:s>select_gest_age_edd</a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="185">
                     <a:s>when </a:s>
                     <a:s r="183">
                        <a:s>&quot;UseLMP&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="184">
                        <a:s>lmp_gest_age_weeks</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="188">
                     <a:s>when </a:s>
                     <a:s r="186">
                        <a:s>&quot;UseUltrasound&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="187">
                        <a:s>ultrasound_gest_age_weeks</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
    </a:s>
                  <a:s r="191">
                     <a:s>when </a:s>
                     <a:s r="189">
                        <a:s>&quot;UseSFH&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="190">
                        <a:s>sfh_gest_age_weeks</a:s>
                     </a:s>
                  </a:s>
                  <a:s r="192">&#xd;
    else null&#xd;
  end</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="193" locator="108:3-113:5" resultTypeName="t:Integer" xsi:type="Case">
            <comparand localId="182" locator="108:8-108:26" resultTypeName="t:Concept" name="select_gest_age_edd" xsi:type="ExpressionRef"/>
            <caseItem localId="185" locator="109:5-109:41">
               <when xsi:type="ToConcept">
                  <operand localId="183" locator="109:10-109:17" resultTypeName="t:Code" name="UseLMP" xsi:type="CodeRef"/>
               </when>
               <then localId="184" locator="109:24-109:41" resultTypeName="t:Integer" name="lmp_gest_age_weeks" xsi:type="ExpressionRef"/>
            </caseItem>
            <caseItem localId="188" locator="110:5-110:55">
               <when xsi:type="ToConcept">
                  <operand localId="186" locator="110:10-110:24" resultTypeName="t:Code" name="UseUltrasound" xsi:type="CodeRef"/>
               </when>
               <then localId="187" locator="110:31-110:55" resultTypeName="t:Integer" name="ultrasound_gest_age_weeks" xsi:type="ExpressionRef"/>
            </caseItem>
            <caseItem localId="191" locator="111:5-111:41">
               <when xsi:type="ToConcept">
                  <operand localId="189" locator="111:10-111:17" resultTypeName="t:Code" name="UseSFH" xsi:type="CodeRef"/>
               </when>
               <then localId="190" locator="111:24-111:41" resultTypeName="t:Integer" name="sfh_gest_age_weeks" xsi:type="ExpressionRef"/>
            </caseItem>
            <else asType="t:Integer" xsi:type="As">
               <operand localId="192" locator="112:10-112:13" resultTypeName="t:Any" xsi:type="Null"/>
            </else>
         </expression>
      </def>
      <def localId="207" locator="115:1-121:4" resultTypeName="t:DateTime" name="edd" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="207">
               <a:s>define edd:&#xd;
  </a:s>
               <a:s r="206">
                  <a:s>case </a:s>
                  <a:s r="195">
                     <a:s>select_gest_age_edd</a:s>
                  </a:s>
                  <a:s>&#xd;
	  </a:s>
                  <a:s r="198">
                     <a:s>when </a:s>
                     <a:s r="196">
                        <a:s>&quot;UseLMP&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="197">
                        <a:s>lmp_edd</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
		</a:s>
                  <a:s r="201">
                     <a:s>when </a:s>
                     <a:s r="199">
                        <a:s>&quot;UseUltrasound&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="200">
                        <a:s>ultrasound_edd</a:s>
                     </a:s>
                  </a:s>
                  <a:s>&#xd;
		</a:s>
                  <a:s r="204">
                     <a:s>when </a:s>
                     <a:s r="202">
                        <a:s>&quot;UseSFH&quot;</a:s>
                     </a:s>
                     <a:s> then </a:s>
                     <a:s r="203">
                        <a:s>sfh_edd</a:s>
                     </a:s>
                  </a:s>
                  <a:s r="205">&#xd;
		else null&#xd;
	end</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="206" locator="116:3-121:4" resultTypeName="t:DateTime" xsi:type="Case">
            <comparand localId="195" locator="116:8-116:26" resultTypeName="t:Concept" name="select_gest_age_edd" xsi:type="ExpressionRef"/>
            <caseItem localId="198" locator="117:4-117:29">
               <when xsi:type="ToConcept">
                  <operand localId="196" locator="117:9-117:16" resultTypeName="t:Code" name="UseLMP" xsi:type="CodeRef"/>
               </when>
               <then localId="197" locator="117:23-117:29" resultTypeName="t:DateTime" name="lmp_edd" xsi:type="ExpressionRef"/>
            </caseItem>
            <caseItem localId="201" locator="118:3-118:42">
               <when xsi:type="ToConcept">
                  <operand localId="199" locator="118:8-118:22" resultTypeName="t:Code" name="UseUltrasound" xsi:type="CodeRef"/>
               </when>
               <then localId="200" locator="118:29-118:42" resultTypeName="t:DateTime" name="ultrasound_edd" xsi:type="ExpressionRef"/>
            </caseItem>
            <caseItem localId="204" locator="119:3-119:28">
               <when xsi:type="ToConcept">
                  <operand localId="202" locator="119:8-119:15" resultTypeName="t:Code" name="UseSFH" xsi:type="CodeRef"/>
               </when>
               <then localId="203" locator="119:22-119:28" resultTypeName="t:DateTime" name="sfh_edd" xsi:type="ExpressionRef"/>
            </caseItem>
            <else asType="t:DateTime" xsi:type="As">
               <operand localId="205" locator="120:8-120:11" resultTypeName="t:Any" xsi:type="Null"/>
            </else>
         </expression>
      </def>
      <def localId="211" locator="123:1-124:16" resultTypeName="t:Boolean" name="Up to 12 Weeks" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="211">
               <a:s>define &quot;Up to 12 Weeks&quot;:&#xd;
  </a:s>
               <a:s r="210">
                  <a:s r="208">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="209"> &lt;= 12</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="210" locator="124:3-124:16" resultTypeName="t:Boolean" xsi:type="LessOrEqual">
            <operand localId="208" locator="124:3-124:10" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="209" locator="124:15-124:16" resultTypeName="t:Integer" valueType="t:Integer" value="12" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="215" locator="126:1-127:15" resultTypeName="t:Boolean" name="20 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="215">
               <a:s>define &quot;20 weeks gestation&quot;:&#xd;
  </a:s>
               <a:s r="214">
                  <a:s r="212">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="213"> = 20</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="214" locator="127:3-127:15" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="212" locator="127:3-127:10" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="213" locator="127:14-127:15" resultTypeName="t:Integer" valueType="t:Integer" value="20" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="219" locator="129:1-130:14" resultTypeName="t:Boolean" name="26 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="219">
               <a:s>define &quot;26 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="218">
                  <a:s r="216">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="217"> = 26</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="218" locator="130:2-130:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="216" locator="130:2-130:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="217" locator="130:13-130:14" resultTypeName="t:Integer" valueType="t:Integer" value="26" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="223" locator="132:1-133:14" resultTypeName="t:Boolean" name="30 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="223">
               <a:s>define &quot;30 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="222">
                  <a:s r="220">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="221"> = 30</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="222" locator="133:2-133:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="220" locator="133:2-133:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="221" locator="133:13-133:14" resultTypeName="t:Integer" valueType="t:Integer" value="30" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="227" locator="135:1-136:14" resultTypeName="t:Boolean" name="34 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="227">
               <a:s>define &quot;34 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="226">
                  <a:s r="224">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="225"> = 34</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="226" locator="136:2-136:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="224" locator="136:2-136:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="225" locator="136:13-136:14" resultTypeName="t:Integer" valueType="t:Integer" value="34" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="231" locator="138:1-139:14" resultTypeName="t:Boolean" name="36 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="231">
               <a:s>define &quot;36 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="230">
                  <a:s r="228">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="229"> = 36</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="230" locator="139:2-139:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="228" locator="139:2-139:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="229" locator="139:13-139:14" resultTypeName="t:Integer" valueType="t:Integer" value="36" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="235" locator="141:1-142:14" resultTypeName="t:Boolean" name="38 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="235">
               <a:s>define &quot;38 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="234">
                  <a:s r="232">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="233"> = 38</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="234" locator="142:2-142:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="232" locator="142:2-142:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="233" locator="142:13-142:14" resultTypeName="t:Integer" valueType="t:Integer" value="38" xsi:type="Literal"/>
         </expression>
      </def>
      <def localId="239" locator="144:1-145:14" resultTypeName="t:Boolean" name="40 weeks gestation" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="239">
               <a:s>define &quot;40 weeks gestation&quot;:&#xd;
	</a:s>
               <a:s r="238">
                  <a:s r="236">
                     <a:s>gest_age</a:s>
                  </a:s>
                  <a:s r="237"> = 40</a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="238" locator="145:2-145:14" resultTypeName="t:Boolean" xsi:type="Equal">
            <operand localId="236" locator="145:2-145:9" resultTypeName="t:Integer" name="gest_age" xsi:type="ExpressionRef"/>
            <operand localId="237" locator="145:13-145:14" resultTypeName="t:Integer" valueType="t:Integer" value="40" xsi:type="Literal"/>
         </expression>
      </def>
   </statements>
</library>


